library(ggthemes)


tiff( 'results/marie_curie/fitness_curves.tiff',
      width = 6.3, height = 6.3, compression = 'lzw',
      unit = 'in', res = 600)

par(mar = c(3,3.5,0.2,0.2), mgp = c(1.9,0.5,0) )

plot(seq(-10, 30, by = 0.1), 
     dnorm( seq(-10, 30, by = 0.1), 17, 3), 
     type='l', lwd = 4, col = 'grey',
     xlab = 'Mean annual temperature (°C)',
     ylab = 'Fitness', cex.lab = 2 )
# abline( v = 20, col = 'grey', lty = 2 )
rect(19, 0.07, 21, 0.09, col = rgb(0.1,0.1,0.1,alpha=0.3))

lines(seq(-10, 30, by = 0.1), 
      dnorm( seq(-10, 30, by = 0.1), 7, 6),
      type='l', lwd = 4,
      col = 'green' )
# abline( v = 10, col = 'green', lty = 2 )
rect(9, 0.05, 11, 0.07, col = rgb(0,1,0,alpha=0.3))

dev.off()



tiff( 'results/marie_curie/fitness_curves_grey.tiff',
      width = 6.3, height = 6.3, compression = 'lzw',
      unit = 'in', res = 600)

par(mfrow=c(1,1), mar = c(3.3,4.2,0.2,0.8), mgp = c(2.3,0.7,0) )

plot(seq(-10, 30, by = 0.1), 
     dnorm( seq(-10, 30, by = 0.1), 17, 3), 
     type='l', lwd = 5, col = 'grey',
     xlab = 'Mean annual temperature (°C)',
     ylab = 'Average species fitness', cex.lab = 2.5, cex.axis=1.5 )
# abline( v = 20, col = 'grey', lty = 2 )
rect(19, 0.07, 21, 0.09, col = rgb(0.1,0.1,0.1,alpha=0.3))

dev.off()


tiff( 'results/marie_curie/fitness_curves_green.tiff',
      width = 6.3, height = 6.3, compression = 'lzw',
      unit = 'in', res = 600)

par(mfrow=c(1,1), mar = c(3.3,4.2,0.2,0.8), mgp = c(2.3,0.7,0) )

plot(seq(-10, 30, by = 0.1), 
     dnorm( seq(-10, 30, by = 0.1), 7, 6),
     type='l', lwd = 5,
     ylim = c(0,0.133),
     xlab = 'Mean annual temperature (°C)',
     ylab = 'Average species fitness', cex.lab = 2.5, cex.axis=1.5,
     col = 'green' )
# abline( v = 10, col = 'green', lty = 2 )
rect(9, 0.05, 11, 0.07, col = rgb(0,1,0,alpha=0.3))

dev.off()




tiff( 'results/marie_curie/fitness_curves_grey.tiff',
      width = 6.3, height = 6.3, compression = 'lzw',
      unit = 'in', res = 600)

par(mfrow=c(1,1), mar = c(3.3,4.2,0.2,0.8), mgp = c(2.3,0.7,0) )

plot(seq(-10, 30, by = 0.1), 
     dnorm( seq(-10, 30, by = 0.1), 17, 3), 
     type='l', lwd = 5, col = 'grey',
     xlab = 'Mean annual temperature (°C)',
     ylab = 'Fitness', cex.lab = 2.5, cex.axis=1.5 )
# abline( v = 20, col = 'grey', lty = 2 )
rect(19, 0.07, 21, 0.09, col = rgb(0.1,0.1,0.1,alpha=0.3))

dev.off()


tiff( 'results/marie_curie/fitness_curves_dorange.tiff',
      width = 6.3, height = 6.3, compression = 'lzw',
      unit = 'in', res = 600)

par(mfrow=c(1,1), mar = c(3.3,4.2,0.2,0.8), mgp = c(2.3,0.7,0) )

plot(seq(-10, 30, by = 0.1), 
     dnorm( seq(-10, 30, by = 0.1), 17, 3), 
     type='l', lwd = 5, 
     col = 'darkorange1',
     xlab = 'Mean annual temperature (°C)',
     ylab = 'Fitness', cex.lab = 2.5, cex.axis=1.5 )
rect(19, 0.07, 21, 0.09, col = rgb(1,0.549,0,alpha=0.3))

dev.off()



tiff( 'results/marie_curie/fitness_curves_blue.tiff',
      width = 6.3, height = 6.3, compression = 'lzw',
      unit = 'in', res = 600)

par(mfrow=c(1,1), mar = c(3.3,4.2,0.2,0.8), mgp = c(2.3,0.7,0) )

plot(seq(-10, 30, by = 0.1), 
     dnorm( seq(-10, 30, by = 0.1), 7, 6),
     type='l', lwd = 5,
     ylim = c(0,0.133),
     xlab = 'Mean annual temperature (°C)',
     ylab = 'Fitness', cex.lab = 2.5, cex.axis=1.5,
     col = 'blue' )
rect(9, 0.05, 11, 0.07, col = rgb(0,0,1,alpha=0.3))

dev.off()



# population level stuff ---------------------------------------------

set.seed( 105)

x_green <- rnorm( 30, 10, 1)
x_grey  <- rnorm( 30, 20, 1)

a_green <- x_green - 10
a_grey  <- x_grey - 20

y_green <- rnorm( 30, a_green * -0.05, 0.16)
y_grey  <- rnorm( 30, a_grey * -0.1,  0.16)

tiff( 'results/marie_curie/population_dynamics.tiff',
      width = 6.3, height = 3.15, compression = 'lzw',
      unit = 'in', res = 600)

par( mfrow = c(1,2), mar = c(3,3,2.8,0.2), mgp = c(1.5,0.5,0) )

plot(x_green, y_green, ylim = c(-0.4, 0.4), pch = 16, 
     ylab = expression('Log population growth rate ('*lambda*')'),
     xlab = 'Annual temperature (°C)', cex.lab = 1.4, 
     col = 'green')
abline( lm(y_green ~ x_green), col = 'green', lwd = 4 )

plot(x_grey, y_grey, ylim = c(-0.4, 0.4),
     pch = 16, col = 'grey', cex.lab = 1.4, 
     ylab = expression('Log population growth rate ('*lambda*')'),
     xlab = 'Annual temperature (°C)' )
abline( lm(y_grey ~ x_grey), col = 'grey', lwd=4 )

dev.off()



tiff( 'results/marie_curie/population_dynamics_dorangeblue.tiff',
      width = 6.3, height = 3.15, compression = 'lzw',
      unit = 'in', res = 600)

par( mfrow = c(1,2), mar = c(3,3,2.8,0.2), mgp = c(1.5,0.5,0) )

plot(x_green, y_green, ylim = c(-0.4, 0.4), pch = 16, 
     ylab = expression('Log population growth rate ('*lambda*')'),
     xlab = 'Annual temperature (°C)', cex.lab = 1.4, 
     col = 'blue')
abline( lm(y_green ~ x_green), col = 'blue', lwd = 4 )

plot(x_grey, y_grey, ylim = c(-0.4, 0.4),
     pch = 16, col = 'darkorange1', cex.lab = 1.4, 
     ylab = expression('Log population growth rate ('*lambda*')'),
     xlab = 'Annual temperature (°C)' )
abline( lm(y_grey ~ x_grey), col = 'darkorange1', lwd=4 )

dev.off()



# Question 1, hypothesis expectation -------------------------------

set.seed( 101 )
x <- seq( 0, 50, by = 5 )
y <- list()
for(i in 1:length(x)){
   sig    <- runif( 1, 2,5 )
   y[[i]] <- rnorm(20, 7 + x[i]*.2, 3 ) %>% setNames(paste0('V',1:20))
}


do.call( rbind, y) %>% 
   cbind(x) %>% 
   as.data.frame %>% 
   gather( rep, y, V1:V20) %>% 
   subset( y > 0 ) %>% 
   ggplot( ) +
   geom_jitter( aes(x,y),
                width = 2 ) +
   theme_few() +
   labs( x = 'Latitude',
         y = 'Average temperature tolerance (°C)',
         title = 'Expectation for Q1, H1' ) +
   theme( title = element_text( vjust = 1) ) +
   ggsave( 'results/marie_curie/Q1H1.tiff',
           width = 3.15, height = 3.15)


# Question 2, hypothesis 2 expectation -------------------------------

set.seed( 102 )
x <- seq( 3, 25, by = 4 )
x1 <- sort( x, decreasing = T )
sig <- seq( 0.05, 0.5, length.out=7)
y <- list()
for(i in 1:length(x)){
   y[[i]] <- rnorm(20, 0.01*x[i], sig[i] ) %>% setNames(paste0('V',1:20))
}


do.call( rbind, y) %>% 
   cbind(x) %>% 
   cbind(x1) %>% 
   as.data.frame %>% 
   gather( rep, y, V1:V20) %>% 
   mutate( y = abs(y) ) %>% 
   ggplot() +
   geom_jitter( aes(x1, y), 
                width = 2) +
   theme_few() +
   labs( x = 'Species temperature tolerance (°C)',
         y = expression('|Effect of temperature on log('*lambda*')|'),
         title = 'Expectation for Q2, H1' ) +
   theme( title = element_text( vjust = 1) ) +
   ggsave( 'results/marie_curie/Q2H2.tiff',
           width = 3.15, height = 3.15)
